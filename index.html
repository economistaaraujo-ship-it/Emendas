<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Consulta de Transfer√™ncias Especiais - SEFAZ-ES</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234f46e5'%3E%3Cpath d='M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z'/%3E%3C/svg%3E">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0f0f0f;
            min-height: 100vh;
            color: #e5e5e5;
        }
        
        .main-header {
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            border-bottom: 1px solid #333;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: white;
        }
        
        .header-title {
            display: flex;
            flex-direction: column;
        }
        
        .header-title h1 {
            font-size: 24px;
            color: #e5e5e5;
            font-weight: 600;
        }
        
        .header-title p {
            font-size: 14px;
            color: #9ca3af;
            margin-top: 2px;
        }
        
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 30px;
        }
        
        .card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .info-banner {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: start;
            gap: 10px;
        }
        
        .info-banner-icon {
            color: #60a5fa;
            font-size: 20px;
            margin-top: 2px;
        }
        
        .info-banner-content {
            flex: 1;
        }
        
        .info-banner-title {
            color: #e5e5e5;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .info-banner-text {
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: end;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-group label {
            font-size: 12px;
            color: #9ca3af;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .control-group input, .control-group select {
            padding: 10px 15px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            font-size: 14px;
            color: #e5e5e5;
            transition: all 0.3s;
        }
        
        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #4f46e5;
            background: #333;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .control-group input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }
        
        .loading-spinner {
            border: 3px solid #2a2a2a;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #450a0a;
            color: #fca5a5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #991b1b;
            white-space: pre-line;
        }
        
        .warning {
            background: #713f12;
            color: #fbbf24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f59e0b;
        }
        
        .success {
            background: #064e3b;
            color: #6ee7b7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #10b981;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
            border: 1px solid #404040;
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.3);
        }
        
        .stat-card h3 {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 26px;
            font-weight: bold;
        }
        
        .stat-card.highlight {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            border-color: #10b981;
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            background: #1a1a1a;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #2a2a2a;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #9ca3af;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #3a3a3a;
            white-space: nowrap;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #2a2a2a;
            color: #e5e5e5;
            font-size: 14px;
        }
        
        tr:hover {
            background: #252525;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
        }
        
        .status-ativa {
            background: #065f46;
            color: #6ee7b7;
            border: 1px solid #10b981;
        }
        
        .status-aguardando {
            background: #713f12;
            color: #fbbf24;
            border: 1px solid #f59e0b;
        }
        
        .status-impedido {
            background: #7f1d1d;
            color: #fca5a5;
            border: 1px solid #ef4444;
        }
        
        .status-conclusao {
            background: #312e81;
            color: #a5b4fc;
            border: 1px solid #6366f1;
        }
        
        .currency {
            font-weight: 600;
            color: #60a5fa;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #e5e5e5;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3a3a3a;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #6b7280;
            font-style: italic;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #2a2a2a;
            text-align: center;
            color: #6b7280;
            font-size: 13px;
        }
        
        .link-button {
            color: #60a5fa;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .link-button:hover {
            color: #93c5fd;
            text-decoration: underline;
        }
        
        .executor-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .executor-name {
            font-weight: 600;
            color: #e5e5e5;
        }
        
        .executor-cnpj {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .nota-box {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
            color: #94a3b8;
        }
        
        .nota-box strong {
            color: #60a5fa;
        }
        
        .nota-box ul {
            margin-top: 10px;
            margin-left: 20px;
        }
        
        .nota-box li {
            margin-bottom: 5px;
        }
        
        .cache-info {
            font-size: 12px;
            color: #6b7280;
            margin-top: 10px;
        }

        .progress-container {
            background: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
            height: 30px;
            position: relative;
        }

        .progress-bar {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #e5e5e5;
            font-weight: 600;
            font-size: 12px;
            z-index: 1;
        }

        /* Responsividade Mobile */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .logo-section {
                flex-direction: column;
                gap: 10px;
            }

            .header-title h1 {
                font-size: 18px;
            }

            .header-title p {
                font-size: 12px;
            }

            .container {
                padding: 0 15px;
                margin: 20px auto;
            }

            .card {
                padding: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                width: 100%;
            }

            .control-group input,
            .control-group select {
                width: 100% !important;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-card .value {
                font-size: 22px;
            }

            .section-title {
                font-size: 16px;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px 8px;
                white-space: nowrap;
            }

            th {
                font-size: 10px;
            }

            .status-badge {
                font-size: 9px;
                padding: 3px 8px;
            }

            .info-banner {
                padding: 12px 15px;
            }

            .info-banner-title {
                font-size: 14px;
            }

            .info-banner-text {
                font-size: 12px;
            }

            .nota-box {
                padding: 12px;
                font-size: 12px;
            }

            .footer {
                font-size: 11px;
            }
        }

        @media (max-width: 480px) {
            .header-title h1 {
                font-size: 16px;
            }

            .logo {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .stats {
                margin-bottom: 20px;
            }

            .stat-card h3 {
                font-size: 10px;
            }

            .stat-card .value {
                font-size: 18px;
            }

            table {
                font-size: 11px;
            }

            th, td {
                padding: 8px 6px;
            }
        }

    </style>
</head>
<body>
    <div class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">ES</div>
                <div class="header-title">
                    <h1>Sistema de Consulta de Transfer√™ncias Especiais</h1>
                    <p>Tesouro Estadual | SEFAZ-ES</p>
                </div>
            </div>
            <div style="text-align: right; color: #6b7280; font-size: 12px;">
                <div>Fonte: API Transferegov.br</div>
                <div style="margin-top: 4px;">Atualiza√ß√£o: D+1</div>
            </div>
        </div>
    </div>
    
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        function TransfereggovConsulta() {
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [warning, setWarning] = useState(null);
            const [success, setSuccess] = useState(null);
            const [data, setData] = useState(null);
            const [cnpj] = useState('27080530000143');
            const [ano, setAno] = useState('2025');
            const [useCache, setUseCache] = useState(true); // Cache ativado por padr√£o
            const [progress, setProgress] = useState({ current: 0, total: 0 });

            // Lista de proxies CORS para fallback autom√°tico (ordem de prioridade)
            const corsProxies = [
                { name: 'corsproxy', url: 'https://corsproxy.io/?' },
                { name: 'allorigins', url: 'https://api.allorigins.win/raw?url=' },
                { name: 'direct', url: '' } // Tentativa direta sem proxy
            ];
            
            const formatCurrency = (value) => {
                if (!value) return 'R$ 0,00';
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(value);
            };
            
            const formatCNPJ = (cnpj) => {
                if (!cnpj) return '';
                const cleaned = cnpj.replace(/\D/g, '');
                return cleaned.replace(
                    /(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/,
                    '$1.$2.$3/$4-$5'
                );
            };
            
            const formatDate = (dateStr) => {
                if (!dateStr) return '-';
                const date = new Date(dateStr);
                return date.toLocaleDateString('pt-BR');
            };
            
            const formatStatus = (status) => {
                if (!status) return status;
                // Remove underscores e capitaliza
                return status
                    .replace(/_/g, ' ')
                    .toLowerCase()
                    .replace(/\b\w/g, l => l.toUpperCase());
            };
            
            const getStatusClass = (status) => {
                if (!status) return 'status-aguardando';
                const statusLower = status.toLowerCase();
                if (statusLower.includes('ativa') || statusLower.includes('ciente')) return 'status-ativa';
                if (statusLower.includes('impedid')) return 'status-impedido';
                if (statusLower.includes('conclusao')) return 'status-conclusao';
                return 'status-aguardando';
            };
            
            // Fun√ß√£o corrigida para construir URL do plano de a√ß√£o
            const buildPlanoAcaoUrl = (codigoPlanoAcao) => {
                // Formato: 09032025-077878
                // Extrair apenas o ID num√©rico ap√≥s o h√≠fen
                if (!codigoPlanoAcao) return null;
                
                const parts = codigoPlanoAcao.split('-');
                if (parts.length !== 2) return null;
                
                const idPlano = parts[1];
                return `https://especiais.transferegov.sistema.gov.br/transferencia-especial/plano-acao/detalhe/${idPlano}/dados-basicos`;
            };
            
            // Cache management - Sistema de m√∫ltiplas camadas
            const getCacheKey = () => `transferegov_${cnpj}_${ano}`;
            const getPersistentCacheKey = () => `transferegov_persistent_${cnpj}_${ano}`;

            // Salva em ambos: sessionStorage (tempor√°rio) e localStorage (persistente)
            const saveToCache = (data) => {
                try {
                    const cacheData = {
                        data: data,
                        timestamp: new Date().getTime(),
                        cnpj: cnpj,
                        ano: ano
                    };

                    // Cache de sess√£o (30 minutos)
                    sessionStorage.setItem(getCacheKey(), JSON.stringify(cacheData));

                    // Cache persistente (7 dias) - backup para quando API estiver indispon√≠vel
                    localStorage.setItem(getPersistentCacheKey(), JSON.stringify(cacheData));

                    console.log('Dados salvos em cache (sess√£o + persistente)');
                } catch (e) {
                    console.error('Erro ao salvar no cache:', e);
                }
            };

            // Tenta carregar do cache com fallback: sessionStorage ‚Üí localStorage
            const loadFromCache = () => {
                try {
                    // Primeiro tenta cache da sess√£o (mais recente)
                    const sessionCached = sessionStorage.getItem(getCacheKey());
                    if (sessionCached) {
                        const cacheData = JSON.parse(sessionCached);
                        const now = new Date().getTime();
                        const cacheAge = (now - cacheData.timestamp) / 1000 / 60; // em minutos

                        if (cacheAge < 30) { // Cache de sess√£o v√°lido por 30 minutos
                            console.log('Usando cache de sess√£o');
                            return cacheData;
                        }
                    }

                    // Se cache de sess√£o expirou, tenta localStorage (persistente)
                    const persistentCached = localStorage.getItem(getPersistentCacheKey());
                    if (persistentCached) {
                        const cacheData = JSON.parse(persistentCached);
                        const now = new Date().getTime();
                        const cacheAge = (now - cacheData.timestamp) / 1000 / 60 / 60 / 24; // em dias

                        if (cacheAge < 7) { // Cache persistente v√°lido por 7 dias
                            console.log('Usando cache persistente (backup)');
                            return cacheData;
                        }
                    }
                } catch (e) {
                    console.error('Erro ao carregar do cache:', e);
                }
                return null;
            };

            const clearCache = () => {
                try {
                    sessionStorage.removeItem(getCacheKey());
                    localStorage.removeItem(getPersistentCacheKey());
                    setSuccess('Cache limpo com sucesso!');
                    setTimeout(() => setSuccess(null), 3000);
                } catch (e) {
                    console.error('Erro ao limpar cache:', e);
                }
            };

            // Fun√ß√£o para carregar dados do cache GitHub (fallback comunit√°rio)
            const loadFromGitHubCache = async () => {
                try {
                    console.log('Tentando carregar cache do GitHub...');
                    const response = await fetch('./cache_data.json?' + new Date().getTime()); // Cache bust
                    if (response.ok) {
                        const githubCache = await response.json();
                        if (githubCache && githubCache.planos && githubCache.planos.length > 0) {
                            console.log('Cache do GitHub carregado com sucesso');
                            return githubCache;
                        }
                    }
                } catch (err) {
                    console.error('Erro ao carregar cache do GitHub:', err);
                }
                return null;
            };
            
            // Sistema de fetch com fallback autom√°tico entre proxies
            const fetchWithAutoProxy = async (url) => {
                let lastError = null;

                // Tenta cada proxy em sequ√™ncia
                for (const proxy of corsProxies) {
                    try {
                        const fullUrl = proxy.url ? proxy.url + encodeURIComponent(url) : url;

                        const response = await fetch(fullUrl, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }

                        // Se chegou aqui, sucesso! Retorna os dados
                        return await response.json();
                    } catch (err) {
                        console.log(`Falha com proxy ${proxy.name}, tentando pr√≥ximo...`);
                        lastError = err;
                        // Continua para o pr√≥ximo proxy
                    }
                }

                // Se chegou aqui, todos os proxies falharam
                throw lastError || new Error('Todos os proxies falharam');
            };
            
            const fetchData = async (forceRefresh = false) => {
                setLoading(true);
                setError(null);
                setWarning(null);
                setSuccess(null);

                // Tentar carregar do cache primeiro (se n√£o for refresh for√ßado)
                if (!forceRefresh && useCache) {
                    const cached = loadFromCache();
                    if (cached) {
                        const cacheAge = (new Date().getTime() - cached.timestamp) / 1000 / 60; // minutos
                        const cacheType = cacheAge < 30 ? 'sess√£o' : 'persistente';
                        setData(cached.data);
                        setSuccess(`Dados carregados do cache ${cacheType} (${new Date(cached.timestamp).toLocaleTimeString('pt-BR')})`);
                        setLoading(false);
                        return;
                    }
                }
                
                try {
                    const baseUrl = 'https://api.transferegov.gestao.gov.br/transferenciasespeciais';

                    // Buscar os planos de a√ß√£o (com fallback autom√°tico de proxies)
                    const planosUrl = `${baseUrl}/plano_acao_especial?cnpj_beneficiario_plano_acao=eq.${cnpj}&ano_plano_acao=eq.${ano}`;
                    console.log('Consultando planos de a√ß√£o...');

                    const planos = await fetchWithAutoProxy(planosUrl);
                    console.log(`Encontrados ${planos.length} planos de a√ß√£o`);

                    // Limitar requisi√ß√µes paralelas para evitar sobrecarga - OTIMIZADO
                    const batchSize = 10; // Aumentado de 3 para 10 para melhor performance
                    const planosCompletos = [];
                    setProgress({ current: 0, total: planos.length });

                    for (let i = 0; i < planos.length; i += batchSize) {
                        const batch = planos.slice(i, i + batchSize);
                        const batchResults = await Promise.all(
                            batch.map(async (plano) => {
                                try {
                                    // Buscar empenhos
                                    const empenhos = await fetchWithAutoProxy(
                                        `${baseUrl}/empenho_especial?id_plano_acao=eq.${plano.id_plano_acao}`
                                    ).catch(() => []);

                                    // Para cada empenho, buscar documentos h√°beis (valores liquidados/pagos)
                                    let valorLiberado = 0;
                                    const documentosHabeis = [];

                                    for (const empenho of empenhos) {
                                        const dhs = await fetchWithAutoProxy(
                                            `${baseUrl}/documento_habil_especial?id_empenho=eq.${empenho.id_empenho}`
                                        ).catch(() => []);

                                        documentosHabeis.push(...dhs);

                                        // Somar valores dos documentos h√°beis (valores liberados/pagos)
                                        dhs.forEach(dh => {
                                            valorLiberado += parseFloat(dh.valor_dh || 0);
                                        });
                                    }

                                    // Buscar executores do plano de a√ß√£o
                                    const executores = await fetchWithAutoProxy(
                                        `${baseUrl}/executor_especial?id_plano_acao=eq.${plano.id_plano_acao}`
                                    ).catch(() => []);

                                    return {
                                        ...plano,
                                        empenhos,
                                        documentosHabeis,
                                        valorLiberado,
                                        executores
                                    };
                                } catch (err) {
                                    console.error('Erro ao buscar dados do plano:', err);
                                    return {
                                        ...plano,
                                        empenhos: [],
                                        documentosHabeis: [],
                                        valorLiberado: 0,
                                        executores: []
                                    };
                                }
                            })
                        );
                        planosCompletos.push(...batchResults);
                        setProgress({ current: Math.min(i + batchSize, planos.length), total: planos.length });
                    }
                    
                    const resultData = { planos: planosCompletos };
                    
                    // Salvar no cache
                    saveToCache(resultData);
                    setData(resultData);
                    setSuccess('Dados carregados com sucesso!');
                    
                } catch (err) {
                    console.error('Erro detalhado:', err);

                    // Sistema de fallback em m√∫ltiplas camadas
                    // 1. Tentar cache local (sessionStorage/localStorage)
                    const cached = loadFromCache();
                    if (cached) {
                        setData(cached.data);
                        const cacheAge = (new Date().getTime() - cached.timestamp) / 1000 / 60; // minutos
                        const cacheType = cacheAge < 30 ? 'sess√£o' : 'persistente';
                        const cacheDate = new Date(cached.timestamp).toLocaleString('pt-BR');
                        setWarning(`‚ö†Ô∏è API temporariamente indispon√≠vel. Exibindo dados do cache ${cacheType} (${cacheDate}).`);
                        setLoading(false);
                        return;
                    }

                    // 2. Tentar cache do GitHub
                    const githubCache = await loadFromGitHubCache();
                    if (githubCache && githubCache.planos && githubCache.planos.length > 0) {
                        setData({ planos: githubCache.planos });
                        const cacheDate = githubCache.timestamp ? new Date(githubCache.timestamp).toLocaleString('pt-BR') : 'data desconhecida';
                        setWarning(`‚ö†Ô∏è API temporariamente indispon√≠vel. Exibindo dados do √∫ltimo backup comunit√°rio (${cacheDate}).`);

                        // Salvar no cache local tamb√©m
                        saveToCache({ planos: githubCache.planos });
                        setLoading(false);
                        return;
                    }

                    // 3. Nenhum fallback dispon√≠vel
                    setError(`‚ùå API temporariamente indispon√≠vel e nenhum dado em cache dispon√≠vel.\n\nPoss√≠veis causas:\n‚Ä¢ API do Transferegov pode estar fora do ar\n‚Ä¢ N√£o h√° dados dispon√≠veis para ${ano}\n‚Ä¢ Problema tempor√°rio de conex√£o\n\nTente novamente mais tarde ou altere o ano da consulta.`);
                } finally {
                    setLoading(false);
                }
            };
            
            const exportToExcel = () => {
                if (!data || !data.planos) return;
                
                // Preparar dados da primeira tabela
                const mainTableData = [];
                data.planos.forEach(plano => {
                    const valorCusteio = parseFloat(plano.valor_custeio_plano_acao || 0);
                    const valorInvestimento = parseFloat(plano.valor_investimento_plano_acao || 0);
                    const valorTotal = valorCusteio + valorInvestimento;
                    const valorLiberadoTotal = parseFloat(plano.valorLiberado || 0);

                    // Distribuir valor liberado proporcionalmente entre custeio e investimento
                    const valorLiberadoCusteio = valorTotal > 0 ? (valorLiberadoTotal * valorCusteio / valorTotal) : 0;
                    const valorLiberadoInvestimento = valorTotal > 0 ? (valorLiberadoTotal * valorInvestimento / valorTotal) : 0;

                    // Calcular valores empenhados por categoria
                    const valorEmpenhadoCusteio = plano.empenhos ? plano.empenhos
                        .filter(emp => emp.categoria_despesa_empenho === 'CUSTEIO')
                        .reduce((sum, emp) => sum + parseFloat(emp.valor_empenho || 0), 0) : 0;

                    const valorEmpenhadoInvestimento = plano.empenhos ? plano.empenhos
                        .filter(emp => emp.categoria_despesa_empenho === 'INVESTIMENTO')
                        .reduce((sum, emp) => sum + parseFloat(emp.valor_empenho || 0), 0) : 0;

                    if (valorCusteio > 0) {
                        mainTableData.push({
                            'C√≥digo Plano': plano.codigo_plano_acao || '-',
                            'N¬∫ Emenda': plano.numero_emenda_parlamentar_plano_acao || '-',
                            'Parlamentar': plano.nome_parlamentar_emenda_plano_acao || '-',
                            'Categoria': 'CUSTEIO',
                            'Banco': plano.nome_banco_plano_acao || '-',
                            'Ag√™ncia': `${plano.numero_agencia_plano_acao || ''}${plano.dv_agencia_plano_acao ? `-${plano.dv_agencia_plano_acao}` : ''}`,
                            'Conta': `${plano.numero_conta_plano_acao || ''}${plano.dv_conta_plano_acao ? `-${plano.dv_conta_plano_acao}` : ''}`,
                            'Situa√ß√£o': plano.situacao_plano_acao || 'Aguardando',
                            'Valor Total': valorCusteio,
                            'Valor Empenhado': valorEmpenhadoCusteio,
                            'Valor Liberado': valorLiberadoCusteio
                        });
                    }

                    if (valorInvestimento > 0) {
                        mainTableData.push({
                            'C√≥digo Plano': plano.codigo_plano_acao || '-',
                            'N¬∫ Emenda': plano.numero_emenda_parlamentar_plano_acao || '-',
                            'Parlamentar': plano.nome_parlamentar_emenda_plano_acao || '-',
                            'Categoria': 'INVESTIMENTO',
                            'Banco': plano.nome_banco_plano_acao || '-',
                            'Ag√™ncia': `${plano.numero_agencia_plano_acao || ''}${plano.dv_agencia_plano_acao ? `-${plano.dv_agencia_plano_acao}` : ''}`,
                            'Conta': `${plano.numero_conta_plano_acao || ''}${plano.dv_conta_plano_acao ? `-${plano.dv_conta_plano_acao}` : ''}`,
                            'Situa√ß√£o': plano.situacao_plano_acao || 'Aguardando',
                            'Valor Total': valorInvestimento,
                            'Valor Empenhado': valorEmpenhadoInvestimento,
                            'Valor Liberado': valorLiberadoInvestimento
                        });
                    }
                });
                
                // Preparar dados da tabela de executores
                const executoresTableData = [];
                data.planos.forEach(plano => {
                    if (plano.executores && plano.executores.length > 0) {
                        plano.executores.forEach(executor => {
                            const valorCusteio = parseFloat(executor.vl_custeio_executor || 0);
                            const valorInvestimento = parseFloat(executor.vl_investimento_executor || 0);

                            if (valorCusteio > 0) {
                                executoresTableData.push({
                                    'N¬∫ Emenda': plano.numero_emenda_parlamentar_plano_acao || '-',
                                    'Parlamentar': plano.nome_parlamentar_emenda_plano_acao || '-',
                                    'Executor': executor.nome_executor || '-',
                                    'CNPJ Executor': executor.cnpj_executor || '-',
                                    'Modalidade': 'CUSTEIO',
                                    'Valor': valorCusteio,
                                    'Banco': executor.nome_banco_executor || '-',
                                    'Ag√™ncia': `${executor.numero_agencia_executor || ''}${executor.dv_agencia_executor ? `-${executor.dv_agencia_executor}` : ''}`,
                                    'Conta': `${executor.numero_conta_executor || ''}${executor.dv_conta_executor ? `-${executor.dv_conta_executor}` : ''}`
                                });
                            }

                            if (valorInvestimento > 0) {
                                executoresTableData.push({
                                    'N¬∫ Emenda': plano.numero_emenda_parlamentar_plano_acao || '-',
                                    'Parlamentar': plano.nome_parlamentar_emenda_plano_acao || '-',
                                    'Executor': executor.nome_executor || '-',
                                    'CNPJ Executor': executor.cnpj_executor || '-',
                                    'Modalidade': 'INVESTIMENTO',
                                    'Valor': valorInvestimento,
                                    'Banco': executor.nome_banco_executor || '-',
                                    'Ag√™ncia': `${executor.numero_agencia_executor || ''}${executor.dv_agencia_executor ? `-${executor.dv_agencia_executor}` : ''}`,
                                    'Conta': `${executor.numero_conta_executor || ''}${executor.dv_conta_executor ? `-${executor.dv_conta_executor}` : ''}`
                                });
                            }
                        });
                    }
                });

                // Criar workbook
                const wb = XLSX.utils.book_new();
                const ws1 = XLSX.utils.json_to_sheet(mainTableData);
                XLSX.utils.book_append_sheet(wb, ws1, "Emendas Parlamentares");

                // Adicionar aba de executores se houver dados
                if (executoresTableData.length > 0) {
                    const ws2 = XLSX.utils.json_to_sheet(executoresTableData);
                    XLSX.utils.book_append_sheet(wb, ws2, "Executores Finais");
                }

                // Gerar arquivo
                const fileName = `transferencias_especiais_${cnpj}_${ano}_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
            };
            
            const calculateTotals = () => {
                if (!data || !data.planos) return {
                    totalCusteio: 0,
                    totalInvestimento: 0,
                    totalGeral: 0,
                    totalEmpenhado: 0,
                    totalLiberado: 0
                };
                
                let totalCusteio = 0;
                let totalInvestimento = 0;
                let totalEmpenhado = 0;
                let totalLiberado = 0;
                
                data.planos.forEach(plano => {
                    totalCusteio += parseFloat(plano.valor_custeio_plano_acao || 0);
                    totalInvestimento += parseFloat(plano.valor_investimento_plano_acao || 0);
                    totalLiberado += parseFloat(plano.valorLiberado || 0);
                    
                    if (plano.empenhos) {
                        plano.empenhos.forEach(empenho => {
                            totalEmpenhado += parseFloat(empenho.valor_empenho || 0);
                        });
                    }
                });
                
                return {
                    totalCusteio,
                    totalInvestimento,
                    totalGeral: totalCusteio + totalInvestimento,
                    totalEmpenhado,
                    totalLiberado
                };
            };
            
            useEffect(() => {
                fetchData();
            }, []);
            
            const totals = calculateTotals();
            
            return (
                <div className="container">
                    <div className="card">
                        <div className="info-banner">
                            <div className="info-banner-icon">‚ÑπÔ∏è</div>
                            <div className="info-banner-content">
                                <div className="info-banner-title">Sobre os Dados</div>
                                <div className="info-banner-text">
                                    Dados obtidos da API Transferegov.br (atualiza√ß√£o D+1).
                                    O sistema mant√©m backups autom√°ticos em m√∫ltiplas camadas para garantir acesso cont√≠nuo,
                                    mesmo quando a API estiver temporariamente indispon√≠vel.
                                </div>
                            </div>
                        </div>
                        
                        <div className="controls">
                            <div className="control-group">
                                <label>CNPJ Benefici√°rio</label>
                                <input
                                    type="text"
                                    value={formatCNPJ(cnpj)}
                                    disabled
                                    style={{ width: '200px' }}
                                />
                            </div>

                            <div className="control-group">
                                <label>Ano</label>
                                <input
                                    type="text"
                                    value={ano}
                                    onChange={(e) => setAno(e.target.value)}
                                    style={{ width: '100px' }}
                                />
                            </div>

                            <button
                                className="btn"
                                onClick={() => fetchData(true)}
                                disabled={loading}
                            >
                                {loading ? 'Consultando...' : 'üîç Consultar'}
                            </button>
                            
                            <button 
                                className="btn btn-warning" 
                                onClick={() => {
                                    setUseCache(!useCache);
                                    if (!useCache) {
                                        const cached = loadFromCache();
                                        if (cached) {
                                            setData(cached.data);
                                            setSuccess(`Cache habilitado. Dados de ${new Date(cached.timestamp).toLocaleTimeString('pt-BR')}`);
                                        }
                                    }
                                }}
                            >
                                {useCache ? '‚úÖ Cache ON' : '‚ùå Cache OFF'}
                            </button>
                            
                            {data && (
                                <>
                                    <button 
                                        className="btn btn-secondary" 
                                        onClick={exportToExcel}
                                    >
                                        üìä Excel
                                    </button>
                                    <button
                                        className="btn btn-warning"
                                        onClick={clearCache}
                                    >
                                        üóëÔ∏è Limpar Cache
                                    </button>
                                </>
                            )}
                        </div>
                        
                        {error && (
                            <div className="error">
                                ‚ö†Ô∏è {error}
                            </div>
                        )}
                        
                        {warning && (
                            <div className="warning">
                                ‚ö†Ô∏è {warning}
                            </div>
                        )}
                        
                        {success && (
                            <div className="success">
                                ‚úÖ {success}
                            </div>
                        )}
                        
                        {loading && progress.total > 0 && (
                            <div className="progress-container">
                                <div
                                    className="progress-bar"
                                    style={{ width: `${(progress.current / progress.total) * 100}%` }}
                                ></div>
                                <div className="progress-text">
                                    Processando {progress.current} de {progress.total} planos...
                                </div>
                            </div>
                        )}

                        {loading && (
                            <div className="loading">
                                <div className="loading-spinner"></div>
                                Carregando dados do Transferegov...
                            </div>
                        )}
                        
                        {data && !loading && (
                            <>
                                <div className="stats">
                                    <div className="stat-card">
                                        <h3>Valor Total</h3>
                                        <div className="value">{formatCurrency(totals.totalGeral)}</div>
                                    </div>
                                    <div className="stat-card">
                                        <h3>Total Custeio</h3>
                                        <div className="value">{formatCurrency(totals.totalCusteio)}</div>
                                    </div>
                                    <div className="stat-card">
                                        <h3>Total Investimento</h3>
                                        <div className="value">{formatCurrency(totals.totalInvestimento)}</div>
                                    </div>
                                    <div className="stat-card">
                                        <h3>Total Empenhado</h3>
                                        <div className="value">{formatCurrency(totals.totalEmpenhado)}</div>
                                    </div>
                                    <div className="stat-card highlight">
                                        <h3>Total Liberado</h3>
                                        <div className="value">{formatCurrency(totals.totalLiberado)}</div>
                                    </div>
                                </div>
                                
                                <h2 className="section-title">Detalhamento por Emenda Parlamentar</h2>
                                
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>C√≥digo Plano</th>
                                                <th>N¬∫ Emenda</th>
                                                <th>Parlamentar</th>
                                                <th>Categoria</th>
                                                <th>Banco</th>
                                                <th>Ag√™ncia</th>
                                                <th>Conta</th>
                                                <th>Situa√ß√£o</th>
                                                <th>Valor Total</th>
                                                <th>Valor Empenhado</th>
                                                <th>Valor Liberado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.planos && data.planos.length > 0 ? (
                                                data.planos.map((plano, index) => {
                                                    const valorCusteio = parseFloat(plano.valor_custeio_plano_acao || 0);
                                                    const valorInvestimento = parseFloat(plano.valor_investimento_plano_acao || 0);
                                                    const valorTotal = valorCusteio + valorInvestimento;
                                                    const valorLiberadoTotal = parseFloat(plano.valorLiberado || 0);
                                                    const urlPlano = buildPlanoAcaoUrl(plano.codigo_plano_acao);

                                                    // Distribuir valor liberado proporcionalmente
                                                    const valorLiberadoCusteio = valorTotal > 0 ? (valorLiberadoTotal * valorCusteio / valorTotal) : 0;
                                                    const valorLiberadoInvestimento = valorTotal > 0 ? (valorLiberadoTotal * valorInvestimento / valorTotal) : 0;

                                                    // Calcular valores empenhados por categoria
                                                    const valorEmpenhadoCusteio = plano.empenhos
                                                        ? plano.empenhos.filter(emp => emp.categoria_despesa_empenho === 'CUSTEIO')
                                                            .reduce((sum, emp) => sum + parseFloat(emp.valor_empenho || 0), 0)
                                                        : 0;

                                                    const valorEmpenhadoInvestimento = plano.empenhos
                                                        ? plano.empenhos.filter(emp => emp.categoria_despesa_empenho === 'INVESTIMENTO')
                                                            .reduce((sum, emp) => sum + parseFloat(emp.valor_empenho || 0), 0)
                                                        : 0;

                                                    const rows = [];
                                                    
                                                    // Linha para CUSTEIO
                                                    if (valorCusteio > 0) {
                                                        rows.push(
                                                            <tr key={`${index}-custeio`}>
                                                                <td>
                                                                    {urlPlano ? (
                                                                        <a 
                                                                            href={urlPlano} 
                                                                            target="_blank" 
                                                                            rel="noopener noreferrer"
                                                                            className="link-button"
                                                                            title="Ver detalhes no Transferegov"
                                                                        >
                                                                            {plano.codigo_plano_acao || '-'}
                                                                            <span style={{ fontSize: '12px' }}>üîó</span>
                                                                        </a>
                                                                    ) : (
                                                                        plano.codigo_plano_acao || '-'
                                                                    )}
                                                                </td>
                                                                <td>{plano.numero_emenda_parlamentar_plano_acao || '-'}</td>
                                                                <td>{plano.nome_parlamentar_emenda_plano_acao || '-'}</td>
                                                                <td>CUSTEIO</td>
                                                                <td>{plano.nome_banco_plano_acao || '-'}</td>
                                                                <td>
                                                                    {plano.numero_agencia_plano_acao}
                                                                    {plano.dv_agencia_plano_acao ? `-${plano.dv_agencia_plano_acao}` : ''}
                                                                </td>
                                                                <td>
                                                                    {plano.numero_conta_plano_acao}
                                                                    {plano.dv_conta_plano_acao ? `-${plano.dv_conta_plano_acao}` : ''}
                                                                </td>
                                                                <td>
                                                                    <span className={`status-badge ${getStatusClass(plano.situacao_plano_acao)}`}>
                                                                        {formatStatus(plano.situacao_plano_acao) || 'Aguardando'}
                                                                    </span>
                                                                </td>
                                                                <td className="currency">{formatCurrency(valorCusteio)}</td>
                                                                <td className="currency">{formatCurrency(valorEmpenhadoCusteio)}</td>
                                                                <td className="currency">{formatCurrency(valorLiberadoCusteio)}</td>
                                                            </tr>
                                                        );
                                                    }
                                                    
                                                    // Linha para INVESTIMENTO
                                                    if (valorInvestimento > 0) {
                                                        rows.push(
                                                            <tr key={`${index}-investimento`}>
                                                                <td>
                                                                    {urlPlano ? (
                                                                        <a 
                                                                            href={urlPlano} 
                                                                            target="_blank" 
                                                                            rel="noopener noreferrer"
                                                                            className="link-button"
                                                                            title="Ver detalhes no Transferegov"
                                                                        >
                                                                            {plano.codigo_plano_acao || '-'}
                                                                            <span style={{ fontSize: '12px' }}>üîó</span>
                                                                        </a>
                                                                    ) : (
                                                                        plano.codigo_plano_acao || '-'
                                                                    )}
                                                                </td>
                                                                <td>{plano.numero_emenda_parlamentar_plano_acao || '-'}</td>
                                                                <td>{plano.nome_parlamentar_emenda_plano_acao || '-'}</td>
                                                                <td>INVESTIMENTO</td>
                                                                <td>{plano.nome_banco_plano_acao || '-'}</td>
                                                                <td>
                                                                    {plano.numero_agencia_plano_acao}
                                                                    {plano.dv_agencia_plano_acao ? `-${plano.dv_agencia_plano_acao}` : ''}
                                                                </td>
                                                                <td>
                                                                    {plano.numero_conta_plano_acao}
                                                                    {plano.dv_conta_plano_acao ? `-${plano.dv_conta_plano_acao}` : ''}
                                                                </td>
                                                                <td>
                                                                    <span className={`status-badge ${getStatusClass(plano.situacao_plano_acao)}`}>
                                                                        {formatStatus(plano.situacao_plano_acao) || 'Aguardando'}
                                                                    </span>
                                                                </td>
                                                                <td className="currency">{formatCurrency(valorInvestimento)}</td>
                                                                <td className="currency">{formatCurrency(valorEmpenhadoInvestimento)}</td>
                                                                <td className="currency">{formatCurrency(valorLiberadoInvestimento)}</td>
                                                            </tr>
                                                        );
                                                    }
                                                    
                                                    return rows;
                                                })
                                            ) : (
                                                <tr>
                                                    <td colSpan="11" className="no-data">
                                                        Nenhuma transfer√™ncia encontrada para este CNPJ no ano especificado
                                                    </td>
                                                </tr>
                                            )}
                                        </tbody>
                                        <tfoot>
                                            <tr style={{ fontWeight: 'bold', backgroundColor: '#252525' }}>
                                                <td colSpan="8">VALOR TOTAL</td>
                                                <td className="currency">{formatCurrency(totals.totalGeral)}</td>
                                                <td className="currency">{formatCurrency(totals.totalEmpenhado)}</td>
                                                <td className="currency">{formatCurrency(totals.totalLiberado)}</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>

                                <h2 className="section-title">Executores Finais dos Recursos</h2>

                                <div className="nota-box">
                                    <strong>‚ÑπÔ∏è Sobre os Executores:</strong>
                                    <div style={{ marginTop: '8px' }}>
                                        Os executores finais s√£o √≥rg√£os, secretarias e entidades respons√°veis pela execu√ß√£o final√≠stica das pol√≠ticas p√∫blicas financiadas pelas emendas parlamentares.
                                        Ap√≥s o recurso ser transferido para a conta do ente p√∫blico (Estado/Munic√≠pio), ele √© repassado para essas institui√ß√µes que implementam efetivamente os projetos.
                                    </div>
                                </div>

                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>N¬∫ Emenda</th>
                                                <th>Parlamentar</th>
                                                <th>Executor</th>
                                                <th>CNPJ</th>
                                                <th>Modalidade</th>
                                                <th>Valor</th>
                                                <th>Banco</th>
                                                <th>Ag√™ncia</th>
                                                <th>Conta</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {(() => {
                                                const executorRows = [];
                                                let totalExecutores = 0;

                                                data.planos.forEach((plano, planoIdx) => {
                                                    if (plano.executores && plano.executores.length > 0) {
                                                        plano.executores.forEach((executor, execIdx) => {
                                                            const valorCusteio = parseFloat(executor.vl_custeio_executor || 0);
                                                            const valorInvestimento = parseFloat(executor.vl_investimento_executor || 0);

                                                            // Linha para CUSTEIO
                                                            if (valorCusteio > 0) {
                                                                totalExecutores += valorCusteio;
                                                                executorRows.push(
                                                                    <tr key={`exec-${planoIdx}-${execIdx}-custeio`}>
                                                                        <td>{plano.numero_emenda_parlamentar_plano_acao || '-'}</td>
                                                                        <td>{plano.nome_parlamentar_emenda_plano_acao || '-'}</td>
                                                                        <td>
                                                                            <div className="executor-info">
                                                                                <span className="executor-name">{executor.nome_executor || '-'}</span>
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <span className="executor-cnpj">{formatCNPJ(executor.cnpj_executor)}</span>
                                                                        </td>
                                                                        <td>CUSTEIO</td>
                                                                        <td className="currency">{formatCurrency(valorCusteio)}</td>
                                                                        <td>{executor.nome_banco_executor || '-'}</td>
                                                                        <td>
                                                                            {executor.numero_agencia_executor}
                                                                            {executor.dv_agencia_executor ? `-${executor.dv_agencia_executor}` : ''}
                                                                        </td>
                                                                        <td>
                                                                            {executor.numero_conta_executor}
                                                                            {executor.dv_conta_executor ? `-${executor.dv_conta_executor}` : ''}
                                                                        </td>
                                                                    </tr>
                                                                );
                                                            }

                                                            // Linha para INVESTIMENTO
                                                            if (valorInvestimento > 0) {
                                                                totalExecutores += valorInvestimento;
                                                                executorRows.push(
                                                                    <tr key={`exec-${planoIdx}-${execIdx}-investimento`}>
                                                                        <td>{plano.numero_emenda_parlamentar_plano_acao || '-'}</td>
                                                                        <td>{plano.nome_parlamentar_emenda_plano_acao || '-'}</td>
                                                                        <td>
                                                                            <div className="executor-info">
                                                                                <span className="executor-name">{executor.nome_executor || '-'}</span>
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <span className="executor-cnpj">{formatCNPJ(executor.cnpj_executor)}</span>
                                                                        </td>
                                                                        <td>INVESTIMENTO</td>
                                                                        <td className="currency">{formatCurrency(valorInvestimento)}</td>
                                                                        <td>{executor.nome_banco_executor || '-'}</td>
                                                                        <td>
                                                                            {executor.numero_agencia_executor}
                                                                            {executor.dv_agencia_executor ? `-${executor.dv_agencia_executor}` : ''}
                                                                        </td>
                                                                        <td>
                                                                            {executor.numero_conta_executor}
                                                                            {executor.dv_conta_executor ? `-${executor.dv_conta_executor}` : ''}
                                                                        </td>
                                                                    </tr>
                                                                );
                                                            }
                                                        });
                                                    }
                                                });

                                                if (executorRows.length === 0) {
                                                    return (
                                                        <tr>
                                                            <td colSpan="9" className="no-data">
                                                                Nenhum executor encontrado para os planos de a√ß√£o
                                                            </td>
                                                        </tr>
                                                    );
                                                }

                                                return (
                                                    <>
                                                        {executorRows}
                                                        <tr style={{ fontWeight: 'bold', backgroundColor: '#252525' }}>
                                                            <td colSpan="5">VALOR TOTAL DOS EXECUTORES</td>
                                                            <td className="currency">{formatCurrency(totalExecutores)}</td>
                                                            <td colSpan="3"></td>
                                                        </tr>
                                                    </>
                                                );
                                            })()}
                                        </tbody>
                                    </table>
                                </div>

                                <div className="footer">
                                    <p>Sistema desenvolvido pelo Tesouro Estadual | SEFAZ-ES</p>
                                    <p>Dados da API Transferegov.br - Atualiza√ß√£o: D+1</p>
                                    <p>{data && loadFromCache() ? 'üì¶ Dados em cache dispon√≠veis' : 'üîÑ Dados em tempo real'}</p>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<TransfereggovConsulta />, document.getElementById('root'));
    </script>
</body>
</html>